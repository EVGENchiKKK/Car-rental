<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - AutoRent</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöó</text></svg>">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="index.html" class="logo">
                    <div class="logo-icon">üöó</div>
                    <div>
                        <h1>AutoRent</h1>
                        <p>–ù–∞ –ª—é–±–æ–π —Å–ª—É—á–∞–π</p>
                    </div>
                </a>

                <div class="nav-menu">
                    <a href="index.html" class="nav-item">–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="branches.html" class="nav-item">–§–∏–ª–∏–∞–ª—ã</a>
                    <a href="booking.html" class="nav-item">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
                    <a href="cars.html" class="nav-item">–ê–≤—Ç–æ–º–æ–±–∏–ª–∏</a>
                </div>

                <div class="user-menu" id="userMenu">
                    <!-- Will be populated by JS -->
                </div>

                <button class="mobile-menu-btn">‚ò∞</button>
            </nav>
        </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="page-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
            <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–º –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏</p>
        </div>
    </section>

    <div class="content-section">
        <div class="container">
            <!-- Auth required message -->
            <div id="authRequired" class="text-center" style="display: none;">
                <div class="card" style="max-width: 500px; margin: 0 auto; padding: 3rem;">
                    <h2>–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                    <p style="margin: 1rem 0; color: #6b7280;">–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</p>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <a href="login.html" class="btn btn-primary">–í–æ–π—Ç–∏</a>
                        <a href="register.html" class="btn btn-outline">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    </div>
                </div>
            </div>

            <!-- Profile content -->
            <div id="profileContent" style="display: none;">
                <div style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem; align-items: start;">
                    
                    <!-- Profile Form -->
                    <div class="card" style="padding: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2>–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                            <button id="editBtn" class="btn btn-outline" onclick="toggleEdit()">
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                        
                        <form id="profileForm">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-field">
                                    <label for="firstName">–ò–º—è</label>
                                    <input type="text" id="firstName" name="firstName" class="form-input" readonly>
                                </div>

                                <div class="form-field">
                                    <label for="lastName">–§–∞–º–∏–ª–∏—è</label>
                                    <input type="text" id="lastName" name="lastName" class="form-input" readonly>
                                </div>
                            </div>

                            <div class="form-field">
                                <label for="middleName">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                                <input type="text" id="middleName" name="middleName" class="form-input" readonly>
                            </div>

                            <div class="form-field">
                                <label for="phone">üì± –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                                <input type="tel" id="phone" name="phone" class="form-input" readonly>
                            </div>

                            <div class="form-field">
                                <label for="passport">üÜî –ü–∞—Å–ø–æ—Ä—Ç</label>
                                <input type="text" id="passport" name="passport" class="form-input" readonly>
                            </div>

                            <div class="form-field">
                                <label for="birthDate">üìÖ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                                <input type="date" id="birthDate" name="birthDate" class="form-input" readonly>
                            </div>

                            <div id="editActions" style="display: none; margin-top: 2rem;">
                                <div style="display: flex; gap: 1rem;">
                                    <button type="submit" class="btn btn-primary" id="saveBtn">
                                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="cancelEdit()">
                                        ‚ùå –û—Ç–º–µ–Ω–∞
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Profile Stats -->
                    <div>
                        <!-- User Stats -->
                        <div class="card" style="padding: 2rem; margin-bottom: 2rem;">
                            <h3 style="margin-bottom: 1.5rem;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            
                            <div style="display: grid; gap: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>–í—Å–µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:</span>
                                    <strong id="totalBookings">0</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>–ê–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:</span>
                                    <strong id="activeBookings" style="color: #10b981;">0</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ:</span>
                                    <strong id="totalSpent" style="color: #3b82f6;">0 ‚ÇΩ</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>–°—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞:</span>
                                    <strong id="clientStatus" style="color: #f59e0b;">–ù–æ–≤—ã–π</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="card" style="padding: 2rem;">
                            <h3 style="margin-bottom: 1.5rem;">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                            
                            <div style="display: grid; gap: 1rem;">
                                <a href="cars.html" class="btn btn-primary" style="text-decoration: none;">
                                    üöó –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å
                                </a>
                                <a href="history.html" class="btn btn-outline" style="text-decoration: none;">
                                    üìã –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
                                </a>
                                <a href="cards.html" class="btn btn-outline" style="text-decoration: none;">
                                    üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã
                                </a>
                                <a href="branches.html" class="btn btn-outline" style="text-decoration: none;">
                                    üè¢ –ù–∞–π—Ç–∏ —Ñ–∏–ª–∏–∞–ª
                                </a>
                            </div>
                        </div>

                        <!-- Logout -->
                        <div class="card" style="padding: 2rem; margin-top: 2rem;">
                            <button onclick="logout()" class="btn" style="width: 100%; background: #ef4444; color: white;">
                                üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Bookings -->
                <div class="card" style="padding: 2rem; margin-top: 2rem;">
                    <h3 style="margin-bottom: 1.5rem;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                    
                    <div id="recentBookings">
                        <p style="color: #6b7280; text-align: center; padding: 2rem;">
                            –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
                        </p>
                    </div>
                    
                    <div class="text-center" style="margin-top: 1.5rem;">
                        <a href="history.html" class="btn btn-outline">
                            –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <p>–¢–µ–ª–µ—Ñ–æ–Ω: 8 (800) 555-35-35</p>
                    <p>–ó–≤–æ–Ω–æ–∫ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π</p>
                </div>

                <div class="footer-section">
                    <h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="branches.html">–§–∏–ª–∏–∞–ª—ã</a>
                    <a href="cars.html">–ê–≤—Ç–æ–º–æ–±–∏–ª–∏</a>
                </div>
                
                <div class="footer-section">
                    <h3>–û –∫–æ–º–ø–∞–Ω–∏–∏</h3>
                    <p>–ù–∞–¥–µ–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∞—Ä–µ–Ω–¥—ã –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π. –ù–∞ –ª—é–±–æ–π —Å–ª—É—á–∞–π, –ª—é–±–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å.</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 AutoRent. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script>
        let currentUser = null;
        let originalUserData = null;
        let isEditing = false;

        // Initialize page
        function init() {
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                currentUser = JSON.parse(userData);
                originalUserData = {...currentUser};
                
                document.getElementById('userMenu').innerHTML = `
                    <a href="profile.html" class="nav-item active">üë§ ${currentUser.firstName}</a>
                    <a href="#" onclick="logout()" class="btn btn-outline">–í—ã–π—Ç–∏</a>
                `;
                
                populateProfile();
                loadBookingStats();
                loadRecentBookings();
                document.getElementById('profileContent').style.display = 'block';
            } else {
                document.getElementById('userMenu').innerHTML = `
                    <a href="login.html" class="btn btn-outline">–í–æ–π—Ç–∏</a>
                    <a href="register.html" class="btn btn-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                `;
                document.getElementById('authRequired').style.display = 'block';
            }
        }

        function populateProfile() {
            document.getElementById('firstName').value = currentUser.firstName || '';
            document.getElementById('lastName').value = currentUser.lastName || '';
            document.getElementById('middleName').value = currentUser.middleName || '';
            document.getElementById('phone').value = currentUser.phone || '';
            document.getElementById('passport').value = currentUser.passport || '';
            document.getElementById('birthDate').value = currentUser.birthDate || '';
        }

        function toggleEdit() {
            isEditing = !isEditing;
            const inputs = document.querySelectorAll('#profileForm input');
            const editBtn = document.getElementById('editBtn');
            const editActions = document.getElementById('editActions');
            
            if (isEditing) {
                inputs.forEach(input => input.readOnly = false);
                editBtn.style.display = 'none';
                editActions.style.display = 'block';
            } else {
                inputs.forEach(input => input.readOnly = true);
                editBtn.style.display = 'block';
                editActions.style.display = 'none';
            }
        }

        function cancelEdit() {
            currentUser = {...originalUserData};
            populateProfile();
            toggleEdit();
        }

        function loadBookingStats() {
            const bookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
            const userBookings = bookings.filter(b => b.user.id === currentUser.id);
            
            const totalBookings = userBookings.length;
            const activeBookings = userBookings.filter(b => {
                const endDate = new Date(b.endDate);
                return endDate >= new Date() && b.status === 'confirmed';
            }).length;
            
            const totalSpent = userBookings.reduce((sum, booking) => {
                const cost = parseInt(booking.totalCost.replace(/[^\d]/g, ''));
                return sum + cost;
            }, 0);
            
            let clientStatus = '–ù–æ–≤—ã–π';
            if (totalBookings >= 10) clientStatus = 'VIP';
            else if (totalBookings >= 5) clientStatus = '–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π';
            else if (totalBookings >= 1) clientStatus = '–ê–∫—Ç–∏–≤–Ω—ã–π';
            
            document.getElementById('totalBookings').textContent = totalBookings;
            document.getElementById('activeBookings').textContent = activeBookings;
            document.getElementById('totalSpent').textContent = totalSpent.toLocaleString() + ' ‚ÇΩ';
            document.getElementById('clientStatus').textContent = clientStatus;
        }

        function loadRecentBookings() {
            const bookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
            const userBookings = bookings
                .filter(b => b.user.id === currentUser.id)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 3);
            
            const container = document.getElementById('recentBookings');
            
            if (userBookings.length === 0) {
                container.innerHTML = `
                    <p style="color: #6b7280; text-align: center; padding: 2rem;">
                        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
                    </p>
                `;
                return;
            }
            
            container.innerHTML = userBookings.map(booking => {
                const startDate = new Date(booking.startDate).toLocaleDateString('ru-RU');
                const endDate = new Date(booking.endDate).toLocaleDateString('ru-RU');
                const statusColor = booking.status === 'confirmed' ? '#10b981' : '#6b7280';
                const statusText = booking.status === 'confirmed' ? '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ' : '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                
                return `
                    <div class="card" style="padding: 1rem; margin-bottom: 1rem; background: #f8fafc;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin: 0 0 0.5rem 0;">${booking.car.name}</h4>
                                <p style="margin: 0; color: #6b7280; font-size: 0.9rem;">
                                    ${startDate} - ${endDate}
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: ${statusColor}; font-weight: 600; font-size: 0.9rem;">
                                    ${statusText}
                                </div>
                                <div style="font-weight: 600; color: #3b82f6;">
                                    ${booking.totalCost}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        }

        // Handle profile form submission
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Validate data
            if (!data.firstName.trim() || !data.lastName.trim()) {
                alert('–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è');
                return;
            }
            
            // Update user data
            currentUser = {
                ...currentUser,
                firstName: data.firstName,
                lastName: data.lastName,
                middleName: data.middleName,
                phone: data.phone,
                passport: data.passport,
                birthDate: data.birthDate
            };
            
            // Save to localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            originalUserData = {...currentUser};
            
            // Update UI
            document.getElementById('userMenu').innerHTML = `
                <a href="profile.html" class="nav-item active">üë§ ${currentUser.firstName}</a>
                <a href="#" onclick="logout()" class="btn btn-outline">–í—ã–π—Ç–∏</a>
            `;
            
            toggleEdit();
            alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
        });

        // Mobile menu toggle
        document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
            const navMenu = document.querySelector('.nav-menu');
            navMenu.style.display = navMenu.style.display === 'flex' ? 'none' : 'flex';
        });

        // Initialize page
        init();
    </script>
</body>
</html>